\begin{figure}[t]
\centering
\begin{tikzpicture}[
node distance=0.5cm,
>=Latex,
box/.style={
  rectangle,
  draw,
  rounded corners,
  align=center,
  minimum width=1.5cm,
  minimum height=1.2cm
},
actor/.style={
  rectangle,
  draw,
  rounded corners,
  align=center,
  minimum width=1.5cm,
  minimum height=1.0cm,
  fill=gray!10
}
]

% Nodes
\node[box] (event) {Platform \\event\\(post, \\reshare, \\reply)};
\node[box, right=of event] (extract) {Local metadata\\extraction};
\node[box, right=of extract] (privacy) {Privacy \\ transform\\(bucketing, \\hashing,\\aggregation, \\$k$-anonymity)};
\node[box, right=of privacy] (ptag) {PTag attached\\to post / stream};

\node[actor, above=2.8cm of ptag] (researchers) {Researchers};
\node[actor, below=2.8cm of ptag] (regulators) {Regulators, \\ auditors};
\node[actor, below=1.8cm of privacy] (internal) {Internal \\platform\\analytics};

% Arrows pipeline
\draw[->] (event) -- (extract);
\draw[->] (extract) -- (privacy);
\draw[->] (privacy) -- (ptag);

% Outputs
\draw[->] (ptag) -- (researchers);
\draw[->] (ptag) -- (regulators);
\draw[->] (ptag) -- (internal);

% Labels
\node[above=0.4cm of extract] {\small Local processing};
\node[above=0.4cm of privacy] {\small Privacy layer};
\node[above=2.0cm of ptag] {\small Behavioral transparency outputs};
\node[below=1.4cm of ptag] {\small Behavioral transparency outputs};

\end{tikzpicture}

\caption{P3Tag system architecture showing the three-stage privacy pipeline from platform events to behavioral transparency. Raw events undergo metadata extraction and privacy transformation within the protected environment before release as anonymized P3Tags to external stakeholders.}

\label{fig:P3Tag-architecture}
\end{figure}
