% !TeX root = 00P2_cep_semantics.tex

\section{Context Tags as Indexed Families}
\label{sec:ctags}

\subsection{\texorpdfstring{Fibered Category
    $\pi : \mathbf{CT} \to \mathbf{CEP}$}
  {Fibered Category pi : CT â†’ CEP}}
% ------------------------------------------------------------

Context tags (CTags) are interpretive annotations attached to a record
without altering its canonical identity.
Their semantics is captured by a
\emph{fibered category}
\begin{equation}
  \pi : \mathbf{CT} \longrightarrow \mathbf{CEP},
\end{equation}
where:
\begin{itemize}
  \item $\mathbf{CEP}$ is the base category of identity-bearing records,
  \item $\mathbf{CT}$ consists of pairs $(R, T)$ of a CEP record $R$ and an attached context tag $T$,
  \item $\pi$ is the projection functor $\pi(R, T) = R$.
\end{itemize}

For a base object $R \in \mathbf{CEP}$, the fiber
\[
  \mathbf{CT}_R = \{ (R, T) \in \mathbf{CT} \mid \pi(R,T) = R \}
\]
collects all valid context tags that may be associated with $R$.
These fibers encode analytic or interpretive information while leaving the
canonical structure and identifier of $R$ unchanged.

\FigureCallout{Context Tags in a Fibered Category (Separation of Concerns)}{
  The projection $\pi : \mathbf{CT} \to \mathbf{CEP}$ cleanly separates
  \emph{identity} (records in $\mathbf{CEP}$) from \emph{interpretation}
  (tags in the fibers $\mathbf{CT}_R$).
  Any morphism in $\mathbf{CEP}$
  induces a coherent reindexing across fibers, ensuring that context tags
  evolve with records while never influencing their SNFEI identity.
}

% ------------------------------------------------------------
\subsection{Functoriality and Reindexing}
% ------------------------------------------------------------

Let
\[
  f : R \longrightarrow R'
\]
be a morphism in $\mathbf{CEP}$ representing a valid evolution or update
of a record.
The fibration provides a corresponding \emph{reindexing
  functor}
\begin{equation}
  f^\ast : \mathbf{CT}_{R'} \longrightarrow \mathbf{CT}_R.
\end{equation}

Intuitively, $f^\ast$ specifies how tags attached to the updated record
$R'$ may be pulled back to valid tags on the earlier state $R$,
preserving interpretive meaning along the update path.

\begin{figure}[ht]
  \centering
  \begin{tikzpicture}[node distance=2.8cm,>=Stealth]
    \node (CR) {$\mathbf{CT}_R$};
    \node (CRp) [right of=CR] {$\mathbf{CT}_{R'}$};

    \node (R) [below of=CR] {$R$};
    \node (Rp) [below of=CRp] {$R'$};

    \draw[->] (CRp) -- node[above] {$f^\ast$} (CR);
    \draw[->] (R) -- node[below] {$f$} (Rp);

    \draw[->] (CR) -- node[left] {$\pi$} (R);
    \draw[->] (CRp) -- node[right] {$\pi$} (Rp);
  \end{tikzpicture}
  \caption{Reindexing in the fibration $\pi : \mathbf{CT} \to \mathbf{CEP}$.}
  \label{fig:fibration-reindex}
\end{figure}

Reindexing satisfies the standard fibration condition:
\begin{equation}
  \pi \circ f^\ast = f \circ \pi,
\end{equation}
so the diagram in Figure~\ref{fig:fibration-reindex} commutes.
Thisexpresses the guiding CEP principle:

\begin{quote}
  \textbf{Context tags move with the record's evolution but never change
    its identity.}
\end{quote}

% ------------------------------------------------------------
\subsection{Identity Preservation and Canonical Invariance}
% ------------------------------------------------------------

A tag object $T \in \mathbf{CT}_R$ must not modify any canonical data
used in identifier generation.
Formally, if $\mathcal{C}$ denotes thecanonicalization functor, then
\begin{equation}
  \mathcal{C}(R) = \mathcal{C}(R, T),
\end{equation}
so attaching tags does not affect the canonical form of $R$.

Equivalently, the projection functor $\pi$ is \emph{identity-reflecting}:
if two tagged objects $(R,T)$ and $(R',T')$
yield the same canonical identifier,
then $R$ and $R'$ must already be
identified in the base category $\mathbf{CEP}$.

Consequently:
\begin{itemize}
  \item CTags are \emph{pure annotations};
  \item they introduce no new canonical structure;
  \item they cannot alter SNFEI values or canonical equivalence classes.
\end{itemize}

This establishes a strict separation between
\[
  \text{identity} \quad (\mathbf{CEP})
  \qquad\text{and}\qquad
  \text{interpretation} \quad (\mathbf{CT}_R).
\]
\FigureCallout{Identity Preservation via Context Tags}{
  Context tags in the fibered category $\pi : \mathbf{CT} \to \mathbf{CEP}$
  are strictly non-influential on canonical identity. The projection
  $\pi$ ensures that no tagged object $(R,T)$ can alter the canonical form
  or SNFEI of its base record $R$, preserving CEP's invariants.
}
