# .github/workflows/arxiv-prep.yml
name: Prepare arXiv Source

on:
  workflow_dispatch:
    inputs:
      paper_dir:
        description: "Relative path to the paper directory (e.g., 2025_12_theory_paper)"
        required: true
        default: "2025_12_theory_paper"

jobs:
  arxiv-source:
    runs-on: ubuntu-latest

    env:
      PAPER_DIR: ${{ github.event.inputs.paper_dir }}

    steps:
      - name: Checkout repository
        uses: actions/checkout@v6

      - name: Create staging directory
        run: |
          mkdir -p arxiv_src
          cp -R "$PAPER_DIR"/* arxiv_src/

      - name: Remove CI- and build-specific files
        working-directory: arxiv_src
        run: |
          # Remove latexmk config (arXiv should manage its own build)
          if [ -f ".latexmkrc" ]; then
            rm .latexmkrc
          fi

          # Remove build directory if present
          if [ -d "build" ]; then
            rm -rf build
          fi

          # Remove common LaTeX auxiliary files
          find . -type f \( \
            -name "*.aux" -o -name "*.log"  -o -name "*.out"  -o -name "*.toc" -o\
            -name "*.bbl" -o -name "*.bcf"  -o -name "*.blg"  -o -name "*.run.xml" -o\
            -name "*.fls" -o -name "*.fdb_latexmk" -o -name "*.synctex.gz" \
          \) -delete

      - name: Create arXiv source zip
        run: |
          cd arxiv_src
          zip -r ../arxiv-source.zip .

      - name: Upload arXiv source artifact
        uses: actions/upload-artifact@v4
        with:
          name: arxiv-source
          path: arxiv-source.zip
          if-no-files-found: error
